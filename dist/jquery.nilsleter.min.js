/*
 *  Nilsleter - v0.0.1
 *  Newsletter for all
 *  http://jqueryboilerplate.com
 *
 *  Made by Diogo Moretti
 *  Under MIT License
 */
!function(a){function b(b,e){this.element=b,this.settings=a.extend({},d,e),this._defaults=d,this._name=c,this.init()}var c="nilsleter",d={modal:!1,estado:["PR","SC","SP","RS"],nivel:["Iniciante","Intermediário","Avançado","Ninja"]};b.prototype={init:function(){var b=a(this.element),c=this.settings;label={title:"nilsleter",nome:"Nome",email:"E-mail",estado:"Estado",nivel:"Nível",escolha:"Escolha"},form_open='<form class="form-horizontal nl-form-item" role="form">',form_title="<h1>"+label.title+"</h1>",form_name=' <div class="form-group">',form_name+='  <label for="nl-input-nome" class="col-sm-3 control-label">'+label.nome+"</label>",form_name+='    <div class="col-sm-9">',form_name+='      <input type="text" class="form-control" id="nl-input-nome" value="Name Test" placeholder="'+label.nome+'">',form_name+="    </div>",form_name+=" </div>",form_email=' <div class="form-group">',form_email+='  <label for="nl-input-email" class="col-sm-3 control-label">'+label.email+"</label>",form_email+='    <div class="col-sm-9">',form_email+='      <input type="email" class="form-control" id="nl-input-email" value="d@c.com" placeholder="'+label.email+'">',form_email+="    </div>",form_email+=" </div>",form_estado=' <div class="form-group">',form_estado+='  <label for="nl-select-estado" class="col-sm-3 control-label">'+label.estado+"</label>",form_estado+='    <div class="col-sm-9">',form_estado+='      <select class="form-control" id="nl-select-estado">',form_estado+="      <option>-- "+label.escolha+" seu "+label.estado+" --</option>",a.each(c.fields.estado,function(a,b){form_estado+="<option>"+b+"</option>"}),form_estado+="      </select>",form_estado+="    </div>",form_estado+=" </div>",form_nivel=' <div class="form-group">',form_nivel+='  <label for="nl-select-nivel" class="col-sm-3 control-label">'+label.nivel+"</label>",form_nivel+='    <div class="col-sm-9">',form_nivel+='      <select class="form-control" id="nl-select-nivel">',form_nivel+="      <option>-- "+label.escolha+" seu "+label.nivel+" --</option>",a.each(c.fields.nivel,function(a,b){form_nivel+="<option>"+b+"</option>"}),form_nivel+="      </select>",form_nivel+="    </div>",form_nivel+=" </div>",form_submit='<div class="form-group">',form_submit+='  <div class="col-sm-5 col-sm-offset-3 loading-box">',form_submit+='    <span class="loading-item"></span>',form_submit+="  </div>",form_submit+='  <div class="col-sm-4">',form_submit+='    <button type="submit" class="btn btn-success btn-lg pull-right nl-btn-submit">Enviar</button>',form_submit+="  </div>",form_submit+="</div>",form_close="</form>",modal_open='<div class="modal fade" id="nilsleter-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">',modal_open+='  <div class="modal-dialog">',modal_open+='    <div class="modal-content">',modal_header='<div class="modal-header">',modal_header+='  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>',modal_header+='  <h4 class="modal-title">'+label.title+"</h4>",modal_header+="</div>",modal_content_open='<div class="modal-body">',modal_content_close="</div>",modal_close="</div></div></div>",btnModal='<button class="btn btn-success btn-lg" data-toggle="modal" data-target="#nilsleter-modal">Quero receber novidades</button>',formFull=null,formInner=form_open+form_name+form_email+form_estado+form_nivel+form_submit+form_close,formItemPage=form_open+form_title+form_name+form_email+form_estado+form_nivel+form_submit+form_close,formItemModal=modal_open+modal_header+modal_content_open+formInner+modal_content_close+modal_close,c.modal?formFull=formItemModal:(formFull=formItemPage,btnModal=null),this.makeForm(b,formFull,btnModal),b.find(".nl-form-item").submit(this.submitForm)},makeForm:function(a,b,c){a.append(c),a.append(b)},submitForm:function(c){c.preventDefault(),nomeValue=a("#nl-input-nome").val(),emailValue=a("#nl-input-email").val(),estadoValue=a("#nl-select-estado").val(),nivelValue=a("#nl-select-nivel").val(),formValido=!1,a(".loading-item").text("Sending..."),a(".nl-btn-submit").attr("disabled","disabled"),a(".nl-form-item input").map(function(){0===a(this).val().length?(a(this).parents(".form-group").addClass("has-error"),formValido=!1):(a(this).parents(".form-group").removeClass("has-error"),formValido=!0)}),formValido&&(dados=JSON.stringify({token:a.md5(nomeValue),secret:a.md5(emailValue),nome:nomeValue,email:emailValue,estado:estadoValue,nivel:nivelValue}),b.prototype.sendData(dados))},sendData:function(b){console.log(b),a.ajax({type:"GET",url:"/sent/"+b,dataType:"json",success:function(){a(".loading-item").addClass("loading-success").text("Success!")},error:function(){a(".loading-item").addClass("loading-error").text("Error! Try again.")}}),setTimeout(function(){a(".loading-item").removeClass("loading-error loading-success").text(""),a(".nl-btn-submit").removeAttr("disabled")},3e3)}},a.fn[c]=function(d){return this.each(function(){a.data(this,"plugin_"+c)||a.data(this,"plugin_"+c,new b(this,d))})}}(jQuery,window,document);